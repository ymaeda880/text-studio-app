# app.py â€” Text Studio ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
from __future__ import annotations
import streamlit as st

# ============================================================
# ãƒ‘ã‚¹ã®å–å¾—ã¨common_libèª­ã¿è¾¼ã¿ï¼ˆapp.pyã«ãŠã‘ã‚‹ã‚³ãƒ¼ãƒ‰ï¼‰
# ============================================================
from pathlib import Path
import sys

_THIS = Path(__file__).resolve()
APP_ROOT = _THIS.parent
APP_NAME = APP_ROOT.name                  # â† app_name ã‚’è‡ªå‹•å–å¾—
PROJECTS_ROOT = _THIS.parents[2]

if str(PROJECTS_ROOT) not in sys.path:
    sys.path.insert(0, str(PROJECTS_ROOT))

from common_lib.sessions import SessionConfig, init_session, heartbeat_tick
from common_lib.auth.auth_helpers import require_login
from common_lib.ui.banner_lines import render_banner_line_by_key


st.set_page_config(page_title="Text Studio", page_icon="âœï¸", layout="wide")
# ============================================================
# ãƒãƒŠãƒ¼ / ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬æº–æ‹ ï¼‰
# ============================================================
render_banner_line_by_key("purple_light")

# ------------------------------------------------------------
# ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®šï¼ˆStorages æ­£æœ¬ API çµŒç”±ï¼‰
# ------------------------------------------------------------
from common_lib.storage.storages_config import resolve_storages_root

STORAGES_ROOT = resolve_storages_root(PROJECTS_ROOT)

SESSIONS_DB = (
    STORAGES_ROOT
    / "_admin"
    / "sessions"
    / "sessions.db"
)
CFG = SessionConfig()  # heartbeat=30s, TTL=120sï¼ˆæ—¢å®šï¼‰

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ãƒ­ã‚°ã‚¤ãƒ³å¿…é ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

sub = require_login(st)
if not sub:
    st.stop()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ãƒ˜ãƒƒãƒ€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
left, right = st.columns([2, 1])
with left:
    st.title("âœï¸ Text Studio â€” æ–‡ç« ã‚’ç£¨ãAIã‚¹ã‚¿ã‚¸ã‚ª")
with right:
    st.success(f"âœ… ãƒ­ã‚°ã‚¤ãƒ³ä¸­: **{sub}**")

user = sub

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ sessionsï¼ˆåˆæœŸåŒ– + heartbeatï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
init_session(db_path=SESSIONS_DB, cfg=CFG, user_sub=user, app_name=APP_NAME)
heartbeat_tick(db_path=SESSIONS_DB, cfg=CFG, user_sub=user, app_name=APP_NAME)


st.caption("Checkãƒ»Translateãƒ»Summarizeãƒ»Refine â€” all in one workspace.")

st.markdown(
    """
    **å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®é …ç›®**ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å„æ©Ÿèƒ½ãƒšãƒ¼ã‚¸ã¸ç§»å‹•ã—ã¦ãã ã•ã„ã€‚  
    ã¾ãšã¯ **æ–‡ç« æ ¡æ­£** ãƒšãƒ¼ã‚¸ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚
    """
)

st.markdown("""
## ğŸš§ ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ç¾åœ¨ **é–‹ç™ºä¸­** ã§ã™

æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ  **Text Studio** ã¯ã€çš†æ§˜ã®æ¥­å‹™åŠ¹ç‡ã‚’é«˜ã‚ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ç¶™ç¶šçš„ã«æ”¹è‰¯ã‚’é€²ã‚ã¦ã„ã¾ã™ã€‚  
å®Ÿéš›ã«ã”åˆ©ç”¨ã„ãŸã ãã€**æ°—ã¥ã„ãŸç‚¹ãƒ»æ”¹å–„ã—ã¦ã»ã—ã„ç‚¹ãƒ»ä¸å…·åˆ** ãªã©ã«ã¤ã„ã¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ãŠå¯„ã›ãã ã•ã„ã€‚

ã„ãŸã ã„ãŸã”æ„è¦‹ã‚’ã‚‚ã¨ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æ”¹å–„ã‚’è¡Œã„ã€  
ã‚ˆã‚Šä½¿ã„ã‚„ã™ãã€æ¥­å‹™ã«å½¹ç«‹ã¤ãƒ„ãƒ¼ãƒ«ã¸ã¨ä»•ä¸Šã’ã¦ã¾ã„ã‚Šã¾ã™ã€‚

ã”å”åŠ›ã®ã»ã©ã€ã©ã†ãã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚
""")

st.markdown("""
## ğŸ“ æ ¡æ­£ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦

**æ–‡ç« æ ¡æ­£** ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ç¾åœ¨ã€**ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¦æ ¡æ­£ã™ã‚‹æ–¹å¼**ã§å‹•ä½œã—ã¦ã„ã¾ã™ãŒï¼Œ
ã“ã®æ”¹è‰¯ç‰ˆã§ã¯ï¼Œ**Wordãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.docxï¼‰ã‚’wordè§£æã«ãƒ‰ãƒ­ãƒƒãƒ—ã—**ã€ä¸­é–“è§£æãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ï¼Œ
inBoxã¸ä¿å­˜ã™ã‚‹ã¨ï¼ŒinBoxã‹ã‚‰æ–‡ç« æ ¡æ­£ã¸å…¥åŠ›ã§ãã‚‹çµ±åˆå‹ãƒ„ãƒ¼ãƒ«ã«ãªã£ã¦ã„ã¾ã™ã€‚

ã—ã‹ã—ï¼Œã¾ã é–‹ç™ºé€”ä¸­ã§ã‚ã‚Šã€ã”ä¸ä¾¿ã‚’ãŠã‹ã‘ã™ã‚‹ç‚¹ã‚‚å¤šã„ã‹ã¨æ€ã„ã¾ã™ãŒã€  
çš†æ§˜ã‹ã‚‰ã® **ç©æ¥µçš„ãªã”åˆ©ç”¨ã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯** ãŒæ”¹å–„ã®å¤§ããªåŠ›ã«ãªã‚Šã¾ã™ã€‚

ã‚ˆã‚Šè‰¯ã„æ ¡æ­£ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å…±ã«è‚²ã¦ã¦ã„ããŸã‚ã€  
ä½•å’ã”å”åŠ›ã®ã»ã©ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚
""")
